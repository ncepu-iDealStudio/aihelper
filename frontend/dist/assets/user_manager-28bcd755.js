import{i as L,u as N,r as w,s as R,g as F,b as T,t as D,m as f,v as q,w as H,x as I,y as G}from"./index-c5ed8602.js";import{d as y,O as C,P as S,R as z,e as v,V as $,W as c,Y as o,H as _,_ as O,r as A,l as p,c as W,Z,F as j}from"./vue-c727071f.js";import{e as Y,s as E,t as B,C as J,M as K,N as U,i as V,L as Q}from"./naive_ui-1fdfc3bf.js";import{T as X}from"./TrashOutline-80d05170.js";import{P as ee}from"./Pencil-002fd4d9.js";const te={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ae=z("path",{d:"M3 17h18c.55 0 1 .45 1 1s-.45 1-1 1H3c-.55 0-1-.45-1-1s.45-1 1-1zm-.5-4.43c.36.21.82.08 1.03-.28l.47-.82l.48.83c.21.36.67.48 1.03.28c.36-.21.48-.66.28-1.02l-.49-.84h.95c.41 0 .75-.34.75-.75s-.34-.75-.75-.75H5.3l.47-.82c.21-.36.09-.82-.27-1.03a.764.764 0 0 0-1.03.28L4 8.47l-.47-.82a.764.764 0 0 0-1.03-.28c-.36.21-.48.67-.27 1.03l.47.82h-.95c-.41 0-.75.34-.75.75s.34.75.75.75h.95l-.48.83c-.2.36-.08.82.28 1.02zm8 0c.36.21.82.08 1.03-.28l.47-.82l.48.83c.21.36.67.48 1.03.28c.36-.21.48-.66.28-1.02l-.48-.83h.95c.41 0 .75-.34.75-.75s-.34-.75-.75-.75h-.96l.47-.82a.76.76 0 0 0-.27-1.03a.746.746 0 0 0-1.02.27l-.48.82l-.47-.82a.742.742 0 0 0-1.02-.27c-.36.21-.48.67-.27 1.03l.47.82h-.96a.74.74 0 0 0-.75.74c0 .41.34.75.75.75h.95l-.48.83c-.2.36-.08.82.28 1.02zM23 9.97c0-.41-.34-.75-.75-.75h-.95l.47-.82a.76.76 0 0 0-.27-1.03a.746.746 0 0 0-1.02.27l-.48.83l-.47-.82a.742.742 0 0 0-1.02-.27c-.36.21-.48.67-.27 1.03l.47.82h-.95a.743.743 0 0 0-.76.74c0 .41.34.75.75.75h.95l-.48.83a.74.74 0 0 0 .28 1.02c.36.21.82.08 1.03-.28l.47-.82l.48.83c.21.36.67.48 1.03.28c.36-.21.48-.66.28-1.02l-.48-.83h.95c.4-.01.74-.35.74-.76z",fill:"currentColor"},null,-1),le=[ae],se=y({name:"PasswordRound",render:function(t,e){return C(),S("svg",te,le)}}),ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},oe=z("path",{d:"M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z",fill:"currentColor"},null,-1),ie=[oe],re=y({name:"RefreshFilled",render:function(t,e){return C(),S("svg",ne,ie)}}),ue=y({__name:"EditUserForm",props:{user:{}},emits:["update:user"],setup(h,{emit:t}){const e=h,m=L.global.t,k={username:{required:!0,message:m("tips.pleaseEnterUsername"),trigger:"blur"},password:{required:!0,message:m("tips.pleaseEnterPassword"),trigger:"blur"},email:{required:!0,message:m("tips.pleaseEnterEmail"),trigger:"blur"},nickname:{required:!0,message:m("tips.pleaseEnterNickname"),trigger:"blur"}},g=v({get:()=>e.user.username,set:n=>{e.user.username=n,t("update:user",{...e.user,username:n})}}),b=v({get:()=>e.user.password,set:n=>{e.user.password=n,t("update:user",{...e.user,password:n})}}),a=v({get:()=>e.user.email,set:n=>{e.user.email=n,t("update:user",{...e.user,email:n})}}),i=v({get:()=>e.user.nickname,set:n=>{e.user.nickname=n,t("update:user",{...e.user,nickname:n})}});return(n,r)=>{const l=Y,s=E,x=B;return C(),$(x,{model:e.user,rules:k,ref:"formRef","label-col":{span:8},"wrapper-col":{span:16}},{default:c(()=>[o(s,{label:_(m)("commons.username"),path:"username"},{default:c(()=>[o(l,{value:g.value,"onUpdate:value":r[0]||(r[0]=d=>g.value=d),placeholder:""},null,8,["value"])]),_:1},8,["label"]),o(s,{label:_(m)("commons.nickname"),path:"nickname"},{default:c(()=>[o(l,{value:i.value,"onUpdate:value":r[1]||(r[1]=d=>i.value=d),placeholder:""},null,8,["value"])]),_:1},8,["label"]),o(s,{label:_(m)("commons.password"),path:"password"},{default:c(()=>[o(l,{value:b.value,"onUpdate:value":r[2]||(r[2]=d=>b.value=d),placeholder:""},null,8,["value"])]),_:1},8,["label"]),o(s,{label:_(m)("commons.email"),path:"email"},{default:c(()=>[o(l,{value:a.value,"onUpdate:value":r[3]||(r[3]=d=>a.value=d),placeholder:""},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),me=y({__name:"EditLimitForm",props:{limit:{}},emits:["update:limit"],setup(h,{emit:t}){const e=h,m=L.global.t,k=l=>l==-1?m("commons.unlimited"):l,g=l=>l==m("commons.unlimited")?-1:parseInt(l),b=v({get:()=>e.limit.can_use_paid,set:l=>{e.limit.can_use_paid=l,t("update:limit",{...e.limit,can_use_paid:l})}}),a=v({get:()=>e.limit.can_use_gpt4,set:l=>{e.limit.can_use_gpt4=l,t("update:limit",{...e.limit,can_use_gpt4:l})}}),i=v({get:()=>e.limit.max_conv_count,set:l=>{e.limit.max_conv_count=l,t("update:limit",{...e.limit,max_conv_count:l})}}),n=v({get:()=>e.limit.available_ask_count,set:l=>{e.limit.available_ask_count=l,t("update:limit",{...e.limit,available_ask_count:l})}}),r=v({get:()=>e.limit.available_gpt4_ask_count,set:l=>{e.limit.available_gpt4_ask_count=l,t("update:limit",{...e.limit,available_gpt4_ask_count:l})}});return(l,s)=>{const x=J,d=E,P=K,M=B;return C(),$(M,{"label-placement":"left","label-width":"auto",style:{maxWidth:"640px"}},{default:c(()=>[o(d,{modelValue:e.limit,"onUpdate:modelValue":s[1]||(s[1]=u=>e.limit=u),label:_(m)("commons.canUsePaidModel"),path:"can_use_paid"},{default:c(()=>[o(x,{value:b.value,"onUpdate:value":s[0]||(s[0]=u=>b.value=u),placeholder:""},null,8,["value"])]),_:1},8,["modelValue","label"]),o(d,{modelValue:e.limit,"onUpdate:modelValue":s[3]||(s[3]=u=>e.limit=u),label:_(m)("commons.canUseGPT4Model"),path:"can_use_paid"},{default:c(()=>[o(x,{value:a.value,"onUpdate:value":s[2]||(s[2]=u=>a.value=u),placeholder:""},null,8,["value"])]),_:1},8,["modelValue","label"]),o(d,{modelValue:e.limit,"onUpdate:modelValue":s[5]||(s[5]=u=>e.limit=u),label:_(m)("commons.maxConversationCount"),path:"max_conv_count"},{default:c(()=>[o(P,{value:i.value,"onUpdate:value":s[4]||(s[4]=u=>i.value=u),parse:g,format:k},null,8,["value"])]),_:1},8,["modelValue","label"]),o(d,{modelValue:e.limit,"onUpdate:modelValue":s[7]||(s[7]=u=>e.limit=u),label:_(m)("commons.availableAskCount"),path:"available_ask_count"},{default:c(()=>[o(P,{value:n.value,"onUpdate:value":s[6]||(s[6]=u=>n.value=u),parse:g,format:k},null,8,["value"])]),_:1},8,["modelValue","label"]),o(d,{modelValue:e.limit,"onUpdate:modelValue":s[9]||(s[9]=u=>e.limit=u),label:_(m)("commons.availableGPT4AskCount"),path:"available_gpt4_ask_count"},{default:c(()=>[o(P,{value:r.value,"onUpdate:value":s[8]||(s[8]=u=>r.value=u),parse:g,format:k},null,8,["value"])]),_:1},8,["modelValue","label"])]),_:1})}}}),ce={class:"mb-4 flex flex-row space-x-2"},fe=y({__name:"user_manager",setup(h){const{t}=O();N();const e=A([]),m=()=>{w().then(a=>{e.value=a.data,f.success(t("tips.refreshed"))})};w().then(a=>{e.value=a.data});const k=[{title:"#",key:"id"},{title:t("commons.username"),key:"username"},{title:t("commons.nickname"),key:"nickname"},{title:t("commons.status"),key:"chat_status",render(a){return a.chat_status?t(R[a.chat_status]):""},sorter:"default"},{title:t("commons.activeTime"),key:"active_time",render(a){return a.active_time?new Date(a.active_time+"Z").toLocaleString():t("commons.neverActive")},sorter:(a,i)=>!a.active_time||!i.active_time?0:new Date(a.active_time).getTime()-new Date(i.active_time).getTime()},{title:t("commons.maxConversationCount"),key:"max_conv_count",render(a){return F(a.max_conv_count)}},{title:t("commons.availableAskCount"),key:"available_ask_count",render(a){return F(a.available_ask_count)}},{title:t("commons.email"),key:"email"},{title:t("commons.isSuperuser"),key:"is_superuser",render(a){return a.is_superuser?t("commons.yes"):t("commons.no")}},{title:t("commons.actions"),key:"actions",fixed:"right",render(a){return p("div",{class:"flex justify-start space-x-2"},[p(U,{size:"small",type:"error",circle:!0,secondary:!0,onClick:()=>{const i=T.warning({title:t("commons.deleteUser"),content:t("tips.deleteUserConfirm"),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(i.loading=!0,new Promise((n,r)=>{D(a.id).then(l=>{f.success(t("tips.deleteUserSuccess")),w().then(s=>{e.value=s.data}),n(!0)}).catch(l=>{f.error(t("tips.deleteUserFailed")+": "+l),r(l)}).finally(()=>{i.loading=!1})}))})}},{icon:()=>p(V,null,{default:()=>p(X)})}),p(U,{size:"small",type:"info",circle:!0,secondary:!0,onClick:()=>{q(async i=>{await G(a.id,i)},()=>{f.info(t("tips.resetUserPasswordSuccess"))},()=>{f.error(t("tips.resetUserPasswordFailed"))})}},{icon:()=>p(V,null,{default:()=>p(se)})}),p(U,{size:"small",type:"primary",circle:!0,secondary:!0,onClick:b(a)},{icon:()=>p(V,null,{default:()=>p(ee)})})])}}],g=()=>{const a=A({username:"",nickname:"",email:"",password:"",is_superuser:!1}),i=T.info({title:t("commons.addUser"),content:()=>p(ue,{user:a.value,"onUpdate:user":n=>{a.value=n}},{default:()=>""}),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(i.loading=!0,new Promise((n,r)=>{I(a.value).then(l=>{f.success(t("commons.addUserSuccess")),w().then(s=>{e.value=s.data}),n(!0)}).catch(l=>{f.error(t("commons.addUserFailed")+": "+l),r(l)}).finally(()=>{i.loading=!1})}))})},b=a=>()=>{const i=A({max_conv_count:a.max_conv_count,available_ask_count:a.available_ask_count,can_use_paid:a.can_use_paid,can_use_gpt4:a.can_use_gpt4,available_gpt4_ask_count:a.available_gpt4_ask_count}),n=T.info({title:t("commons.setUserLimit"),content:()=>p(me,{limit:i.value,"onUpdate:limit":r=>{i.value=r}},{default:()=>""}),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(n.loading=!0,new Promise((r,l)=>{H(a.id,i.value).then(s=>{f.success(t("commons.setUserLimitSuccess")),w().then(x=>{e.value=x.data}),r(!0)}).catch(s=>{l(s)}).finally(()=>{n.loading=!1})}))})};return(a,i)=>{const n=Q;return C(),S(j,null,[z("div",ce,[o(_(U),{type:"primary",onClick:g},{default:c(()=>[W(Z(a.$t("commons.addUser")),1)]),_:1}),o(_(U),{text:"",onClick:m},{icon:c(()=>[o(_(V),null,{default:c(()=>[o(_(re))]),_:1})]),_:1})]),o(n,{"scroll-x":800,size:"small",columns:k,data:e.value,bordered:!0,pagination:{pageSize:20}},null,8,["data"])],64)}}});export{fe as default};
//# sourceMappingURL=user_manager-28bcd755.js.map

import{d as T,O as A,P as b,R as k,r as x,e as z,V as B,H as l,_ as I,l as f,Y as r,W as u,c as g,Z as w,k as D,v as M,F as O}from"./vue-c727071f.js";import{i as E,r as H,z as C,c as K,b as y,m,A as R,B as F,C as j}from"./index-c5ed8602.js";import{O as L,o as N,N as _,L as Z,i as S}from"./naive_ui-1fdfc3bf.js";import{T as W}from"./TrashOutline-80d05170.js";const Y={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},q=k("path",{d:"M14 9l-1-2H7V5.72c.6-.34 1-.98 1-1.72c0-1.1-.9-2-2-2s-2 .9-2 2c0 .74.4 1.38 1 1.72V21h2v-4h5l1 2h7V9h-6zm4 8h-4l-1-2H7V9h5l1 2h5v6z",fill:"currentColor"},null,-1),G=[q],J=T({name:"EmojiFlagsFilled",render:function(t,a){return A(),b("svg",Y,G)}}),Q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},X=k("path",{d:"M13 8c0-2.21-1.79-4-4-4S5 5.79 5 8s1.79 4 4 4s4-1.79 4-4zm2 2v2h3v3h2v-3h3v-2h-3V7h-2v3h-3zM1 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4z",fill:"currentColor"},null,-1),ee=[X],te=T({name:"PersonAddAlt1Filled",render:function(t,a){return A(),b("svg",Q,ee)}}),ne=T({__name:"UserSelector",emits:["update:value"],setup(U,{emit:t}){const a=E.global.t,h=x([]),i=x(null),V=c=>!0,$=c=>{t("update:value",c)};H().then(c=>{h.value=c.data});const P=z(()=>h.value.map(c=>({label:c.username,value:c.username})));return(c,p)=>{const e=L;return A(),B(e,{"get-show":V,value:i.value,"onUpdate:value":[p[0]||(p[0]=n=>i.value=n),$],options:P.value,placeholder:l(a)("commons.chooseUser")},null,8,["value","options","placeholder"])}}}),oe={class:"mb-4 mt-1 flex flex-row justify-between"},se={class:"space-x-2"},ce=T({__name:"conversation_manager",setup(U){const{t}=I(),a=x([]),h=e=>e.conversation_id,i=x([]);C(!0).then(e=>{a.value=e.data});const V=[{type:"selection"},{title:"#",key:"id",sorter:"default"},{title:"UUID",key:"conversation_id",render:e=>f(N,{trigger:"hover"},{trigger:()=>{var n;return(n=e.conversation_id)==null?void 0:n.substring(0,4)},default:()=>e.conversation_id})},{title:t("commons.title"),key:"title",sorter:"default",render:e=>f(_,{text:!0,tag:"a",href:`/conv/${e.conversation_id}`,target:"_blank"},{default:()=>e.title?e.title:t("commons.empty")})},{title:t("commons.belongToUser"),key:"user_id",render:e=>e.user_id?e.user_id:t("commons.empty"),sorter:"default"},{title:t("commons.createTime"),key:"create_time",defaultSortOrder:"descend",sorter:(e,n)=>!e.create_time||!n.create_time?0:new Date(e.create_time).getTime()-new Date(n.create_time).getTime(),render:e=>e.create_time?f(N,{trigger:"hover"},{trigger:()=>new Date(e.create_time+"Z").toLocaleString(),default:()=>e.create_time}):""},{title:t("commons.modelName"),key:"model_name",render(e){return e.model_name?K(e.model_name):t("commons.unknown")},sorter:"default"},{title:t("commons.isValid"),key:"is_valid",render(e){return e.is_valid?t("commons.yes"):t("commons.no")},sorter:(e,n)=>{const o=e.is_valid?1:0,d=n.is_valid?1:0;return o-d}}],$=()=>{const e=y.info({title:t("commons.invalidateConversation"),content:t("tips.invalidateConversation"),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(e.loading=!0,new Promise((n,o)=>{(async()=>{for(const s of i.value)await R(s)})().then(()=>{m.success(t("tips.deleteConversationSuccess")),C(!0).then(s=>{a.value=s.data}),n(!0)}).catch(s=>{m.error(t("tips.deleteConversationFailed")+": "+s),o(s)}).finally(()=>{e.loading=!1})}))})},P=()=>{const e=y.warning({title:t("commons.vanishConversation"),content:t("tips.vanishConversation"),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(e.loading=!0,new Promise((n,o)=>{(async()=>{for(const s of i.value)await F(s)})().then(()=>{m.success(t("tips.success")),C(!0).then(s=>{a.value=s.data}),i.value=[],n(!0)}).catch(s=>{m.error(t("tips.failed")+": "+s),o(s)}).finally(()=>{e.loading=!1})}))})},c=()=>{let e=null;const n=y.warning({title:t("commons.chooseUserToAssign"),content:()=>f(ne,{"onUpdate:value":o=>{e=o}}),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(n.loading=!0,new Promise((o,d)=>{if(e===null){m.error(t("errors.noUserSelected")),n.loading=!1,d(!1);return}(async()=>{for(const v of i.value)await j(v,e)})().then(()=>{m.success(t("tips.success")),C(!0).then(v=>{a.value=v.data}),i.value=[],o(!0)}).catch(v=>{m.error(t("tips.failed")+": "+v),d(v)}).finally(()=>{n.loading=!1})}))})},p=()=>{const e=y.info({title:t("commons.deleteInvalidConversations"),content:t("commons.deleteInvalidConversationsConfirm"),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>{e.loading=!0;const n=async()=>{for(const o of a.value)o.is_valid||await F(o.conversation_id);a.value=a.value.filter(o=>o.is_valid)};return new Promise((o,d)=>{n().then(()=>{m.success(t("tips.deleteConversationSuccess")),i.value=[],o(!0)}).catch(s=>{m.error(t("tips.deleteConversationFailed")),d()}).finally(()=>{e.loading=!1})})}})};return(e,n)=>{const o=Z;return A(),b(O,null,[k("div",oe,[r(l(_),{onClick:p},{default:u(()=>[g(w(e.$t("commons.deleteInvalidConversations")),1)]),_:1}),D(k("div",se,[r(l(_),{type:"warning",secondary:"",onClick:$},{icon:u(()=>[r(l(S),null,{default:u(()=>[r(l(J))]),_:1})]),default:u(()=>[g(" "+w(e.$t("commons.invalidateConversation")),1)]),_:1}),r(l(_),{type:"error",secondary:"",onClick:P},{icon:u(()=>[r(l(S),null,{default:u(()=>[r(l(W))]),_:1})]),default:u(()=>[g(" "+w(e.$t("commons.vanishConversation")),1)]),_:1}),r(l(_),{type:"info",secondary:"",onClick:c},{icon:u(()=>[r(l(S),null,{default:u(()=>[r(l(te))]),_:1})]),default:u(()=>[g(" "+w(e.$t("commons.chooseUserToAssign")),1)]),_:1})],512),[[M,i.value.length!==0]])]),r(o,{size:"small",columns:V,data:a.value,bordered:!0,pagination:{pageSize:20},"row-key":h,"checked-row-keys":i.value,"onUpdate:checkedRowKeys":n[0]||(n[0]=d=>i.value=d)},null,8,["data","checked-row-keys"])],64)}}});export{ce as default};
//# sourceMappingURL=conversation_manager-4ae2d1e0.js.map

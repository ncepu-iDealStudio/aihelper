import{d as O,r as g,f as P,_ as F,e as E,O as c,P as M,R as b,V as C,W as i,Y as n,H as y,k as V,v as j,Z as B,a4 as z,w as q,c as K,a0 as X,F as G,X as W,a3 as Y}from"./vue-c727071f.js";import{_ as Z,m as I,c as J,n as Q}from"./index-c5ed8602.js";import{w as A,i as D,n as U,N as $,D as ee,E as te,A as se}from"./naive_ui-1fdfc3bf.js";import{P as oe,C as ne,a as le,b as ae,c as re}from"./conversation-45822fe5.js";const ce={class:"w-10 ml-0 md:ml-2 mt-3"},ie={class:"mx-0 md:mx-4 w-full"},ue=["innerHTML"],me={class:"hide-in-print"},de=O({__name:"MessageRow",props:{message:{}},setup(N){const d=N;let l,v=g(!1);P(()=>{Z(()=>import("./markdown-446d4431.js"),["assets/markdown-446d4431.js","assets/naive_ui-1fdfc3bf.js","assets/vue-c727071f.js"]).then(t=>{l=t.default,v.value=!0})});const{t:S}=F(),w=A();let x=null;const p=g(),u=g(!1),k=()=>{u.value=!u.value},h=E(()=>d.message.model_slug=="gpt-4"),L=E(()=>d.message.author_role=="user"?w.value.bodyColor:w.value.actionColor),_=E(()=>{if(!v.value)return"";const t=l.render(d.message.message||"");return H(t)});function H(t){const a=new DOMParser().parseFromString(t,"text/html"),e=a.getElementsByTagName("pre");for(let f=0;f<e.length;f++){const T=e[f],R=Object.assign(document.createElement("button"),{innerHTML:"",className:"hljs-copy-button hide-in-print"});R.dataset.copied="false",T.classList.add("hljs-copy-wrapper"),T.style.setProperty("--hljs-theme-background",window.getComputedStyle(T).backgroundColor),T.appendChild(R)}return new XMLSerializer().serializeToString(a.documentElement)}P(()=>{if(!p.value)return;const t=(o,a)=>{for(const e of o)e.type==="childList"&&m()};x=new MutationObserver(t),x.observe(p.value,{subtree:!0,childList:!0}),m()});const m=()=>{var o;const t=(o=p.value)==null?void 0:o.querySelectorAll("pre");if(t)for(const a of t)for(const e of a.querySelectorAll("button"))e.onclick=()=>{navigator.clipboard&&navigator.clipboard.writeText(e.parentElement.textContent||"").then(function(){e.innerHTML="Copied!",e.dataset.copied="true";let r=Object.assign(document.createElement("div"),{role:"status",className:"hljs-copy-alert",innerHTML:"Copied to clipboard"});e.parentElement.appendChild(r),setTimeout(()=>{r&&(e.innerHTML="Copy",e.dataset.copied="false",e.parentElement.removeChild(r),r=null)},2e3)}).then()}},s=()=>{navigator.clipboard&&navigator.clipboard.writeText(d.message.message||"").then(()=>{I.success(S("commons.copiedToClipboard"))}).then()};return(t,o)=>{const a=D,e=U,r=$;return c(),M("div",{class:"flex flex-col md:flex-row py-2 md:py-4 px-5 md:px-4 max-w-full relative",style:z({backgroundColor:L.value})},[b("div",ce,[d.message.author_role=="user"?(c(),C(e,{key:0,size:"small"},{default:i(()=>[n(a,null,{default:i(()=>[n(y(oe))]),_:1})]),_:1})):h.value?(c(),C(e,{key:1,size:"small",src:"/chatgpt-icon-black.svg"})):(c(),C(e,{key:2,size:"small",src:"/chatgpt-icon.svg"}))]),b("div",ie,[V(b("div",{ref_key:"contentRef",ref:p,class:"message-content w-full",innerHTML:_.value},null,8,ue),[[j,!u.value]]),V(b("div",{class:"my-3 w-full whitespace-pre-line text-gray-500"},B(d.message.message),513),[[j,u.value]]),b("div",me,[n(r,{text:"",ghost:"",type:"tertiary",size:"tiny",class:"mt-2 -ml-2 absolute bottom-3 right-3 md:bottom-1 md:right-1",onClick:s},{default:i(()=>[n(a,null,{default:i(()=>[n(y(ne))]),_:1})]),_:1}),n(r,{text:"",ghost:"",size:"tiny",type:u.value?"success":"tertiary",class:"mt-2 -ml-2 absolute bottom-3 right-9 md:bottom-1 md:right-5",onClick:k},{default:i(()=>[n(a,null,{default:i(()=>[n(y(le))]),_:1})]),_:1},8,["type"])])])],4)}}});const pe={key:0},ve=O({__name:"HistoryContent",props:{messages:{},modelName:{},fullscreen:{type:Boolean},showTips:{type:Boolean},loading:{type:Boolean}},setup(N,{expose:d}){const l=N,v=g(""),S=()=>{if(localStorage.getItem("id")){const m=localStorage.getItem("id");Q(String(m)).then(s=>{v.value=s.data.title}).catch(s=>{console.log(s)})}else v.value=String(localStorage.getItem("title"))},w=()=>(S(),v.value),{t:x}=F(),p=A(),u=g(),k=g(),h=g(!1),L=E(()=>l.modelName?l.modelName:ae(l.messages));q(()=>l.fullscreen,()=>{_(l.showTips)});const _=m=>{const s=document.getElementById("app"),t=document.body,o=u.value;h.value?(k.value.appendChild(o),s&&(s.style.display="block")):(k.value=o.parentElement,t.insertBefore(o,t.firstChild),s&&(s.style.display="none"),o.focus(),m&&I.success(x("tips.pressEscToExitFullscreen"),{duration:2e3})),h.value=!h.value};return l.fullscreen&&_(l.showTips),d({focus:()=>{u.value.focus()},toggleFullscreenHistory:_}),(m,s)=>{const t=ee,o=D,a=$,e=te,r=se;return c(),M("div",{ref_key:"contentRef",ref:u,id:"print-content",class:"flex flex-col h-full",onKeyup:s[0]||(s[0]=Y(f=>_(!0),["esc"])),tabindex:"0",style:{outline:"none"}},[l.loading?(c(),C(r,{key:1,class:"h-full flex justify-center",style:z({backgroundColor:y(p).cardColor}),description:m.$t("tips.loading")},{icon:i(()=>[n(e,{size:"medium"})]),_:1},8,["style","description"])):(c(),M("div",pe,[b("div",{class:"flex justify-center py-4 px-4 max-w-full relative",style:z({backgroundColor:y(p).baseColor})},[n(t,null,{default:i(()=>[K("当前会话:"+B(w())+" ("+B(y(J)(L.value))+") ",1)]),_:1}),h.value?(c(),C(a,{key:0,class:"absolute left-4 hide-in-print",text:"",onClick:_},{icon:i(()=>[n(o,null,{default:i(()=>[n(y(re))]),_:1})]),_:1})):X("",!0)],4),(c(!0),M(G,null,W(m.messages,f=>(c(),C(de,{message:f,key:f.id},null,8,["message"]))),128))]))],544)}}});export{ve as _};
//# sourceMappingURL=HistoryContent.vue_vue_type_script_setup_true_lang-6de79309.js.map

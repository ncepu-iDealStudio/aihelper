import{d as O,r as y,f as P,_ as F,e as M,O as i,P as N,R as b,V as C,W as u,Y as o,H as r,k as V,z as j,Z as z,a4 as B,w as q,c as K,a0 as X,F as G,X as W,a3 as Y}from"./vue-401fb23c.js";import{_ as Z,m as I,c as J,o as Q}from"./index-66da63bc.js";import{w as A,i as D,n as U,N as $,D as ee,E as te,A as se}from"./naive_ui-f15aaf84.js";import{P as ne,C as oe,a as le,b as ae,c as re}from"./conversation-74fd8a88.js";const ce={class:"w-10 ml-0 md:ml-2 mt-3"},ie={class:"mx-0 md:mx-4 w-full"},ue=["innerHTML"],me={class:"hide-in-print"},de=O({__name:"MessageRow",props:{message:null},setup(w){const d=w;let l,h=y(!1);P(()=>{Z(()=>import("./markdown-89a0a5a0.js"),["assets/markdown-89a0a5a0.js","assets/naive_ui-f15aaf84.js","assets/vue-401fb23c.js"]).then(t=>{l=t.default,h.value=!0})});const{t:S}=F(),x=A();let k=null;const _=y(),m=y(!1),T=()=>{m.value=!m.value},v=M(()=>d.message.model_slug=="gpt-4"),L=M(()=>d.message.author_role=="user"?x.value.bodyColor:x.value.actionColor),f=M(()=>{if(!h.value)return"";const t=l.render(d.message.message||"");return H(t)});function H(t){const a=new DOMParser().parseFromString(t,"text/html"),e=a.getElementsByTagName("pre");for(let g=0;g<e.length;g++){const E=e[g],R=Object.assign(document.createElement("button"),{innerHTML:"",className:"hljs-copy-button hide-in-print"});R.dataset.copied="false",E.classList.add("hljs-copy-wrapper"),E.style.setProperty("--hljs-theme-background",window.getComputedStyle(E).backgroundColor),E.appendChild(R)}return new XMLSerializer().serializeToString(a.documentElement)}P(()=>{if(!_.value)return;const t=(n,a)=>{for(const e of n)e.type==="childList"&&p()};k=new MutationObserver(t),k.observe(_.value,{subtree:!0,childList:!0}),p()});const p=()=>{var n;const t=(n=_.value)==null?void 0:n.querySelectorAll("pre");if(t)for(const a of t)for(const e of a.querySelectorAll("button"))e.onclick=()=>{navigator.clipboard&&navigator.clipboard.writeText(e.parentElement.textContent||"").then(function(){e.innerHTML="Copied!",e.dataset.copied="true";let c=Object.assign(document.createElement("div"),{role:"status",className:"hljs-copy-alert",innerHTML:"Copied to clipboard"});e.parentElement.appendChild(c),setTimeout(()=>{c&&(e.innerHTML="Copy",e.dataset.copied="false",e.parentElement.removeChild(c),c=null)},2e3)}).then()}},s=()=>{navigator.clipboard&&navigator.clipboard.writeText(d.message.message||"").then(()=>{I.success(S("commons.copiedToClipboard"))}).then()};return(t,n)=>{const a=D,e=U,c=$;return i(),N("div",{class:"flex flex-col md:flex-row py-2 md:py-4 px-5 md:px-4 max-w-full relative",style:B({backgroundColor:r(L)})},[b("div",ce,[d.message.author_role=="user"?(i(),C(e,{key:0,size:"small"},{default:u(()=>[o(a,null,{default:u(()=>[o(r(ne))]),_:1})]),_:1})):r(v)?(i(),C(e,{key:1,size:"small",src:"/chatgpt-icon-black.svg"})):(i(),C(e,{key:2,size:"small",src:"/chatgpt-icon.svg"}))]),b("div",ie,[V(b("div",{ref_key:"contentRef",ref:_,class:"message-content w-full",innerHTML:r(f)},null,8,ue),[[j,!m.value]]),V(b("div",{class:"my-3 w-full whitespace-pre-line text-gray-500"},z(d.message.message),513),[[j,m.value]]),b("div",me,[o(c,{text:"",ghost:"",type:"tertiary",size:"tiny",class:"mt-2 -ml-2 absolute bottom-3 right-3 md:bottom-1 md:right-1",onClick:s},{default:u(()=>[o(a,null,{default:u(()=>[o(r(oe))]),_:1})]),_:1}),o(c,{text:"",ghost:"",size:"tiny",type:m.value?"success":"tertiary",class:"mt-2 -ml-2 absolute bottom-3 right-9 md:bottom-1 md:right-5",onClick:T},{default:u(()=>[o(a,null,{default:u(()=>[o(r(le))]),_:1})]),_:1},8,["type"])])])],4)}}});const pe={key:0},he=O({__name:"HistoryContent",props:{messages:null,modelName:null,fullscreen:{type:Boolean},showTips:{type:Boolean},loading:{type:Boolean}},setup(w,{expose:d}){const l=w,h=y(""),S=()=>{if(localStorage.getItem("id")){const p=localStorage.getItem("id");Q(String(p)).then(s=>{h.value=s.data.title}).catch(s=>{console.log(s)})}else h.value=String(localStorage.getItem("title"))},x=()=>(S(),h.value),{t:k}=F(),_=A(),m=y(),T=y(),v=y(!1),L=M(()=>l.modelName?l.modelName:ae(l.messages));q(()=>l.fullscreen,()=>{f(l.showTips)});const f=p=>{const s=document.getElementById("app"),t=document.body,n=m.value;v.value?(T.value.appendChild(n),s&&(s.style.display="block")):(T.value=n.parentElement,t.insertBefore(n,t.firstChild),s&&(s.style.display="none"),n.focus(),p&&I.success(k("tips.pressEscToExitFullscreen"),{duration:2e3})),v.value=!v.value};return l.fullscreen&&f(l.showTips),d({focus:()=>{m.value.focus()},toggleFullscreenHistory:f}),(p,s)=>{const t=ee,n=D,a=$,e=te,c=se;return i(),N("div",{ref_key:"contentRef",ref:m,id:"print-content",class:"flex flex-col h-full",onKeyup:s[0]||(s[0]=Y(g=>f(!0),["esc"])),tabindex:"0",style:{outline:"none"}},[l.loading?(i(),C(c,{key:1,class:"h-full flex justify-center",style:B({backgroundColor:r(_).cardColor}),description:p.$t("tips.loading")},{icon:u(()=>[o(e,{size:"medium"})]),_:1},8,["style","description"])):(i(),N("div",pe,[b("div",{class:"flex justify-center py-4 px-4 max-w-full relative",style:B({backgroundColor:r(_).baseColor})},[o(t,null,{default:u(()=>[K("当前会话:"+z(x())+" ("+z(r(J)(r(L)))+") ",1)]),_:1}),v.value?(i(),C(a,{key:0,class:"absolute left-4 hide-in-print",text:"",onClick:f},{icon:u(()=>[o(n,null,{default:u(()=>[o(r(re))]),_:1})]),_:1})):X("",!0)],4),(i(!0),N(G,null,W(w.messages,g=>(i(),C(de,{message:g,key:g.id},null,8,["message"]))),128))]))],544)}}});export{he as _};
//# sourceMappingURL=HistoryContent.vue_vue_type_script_setup_true_lang-77c29c33.js.map

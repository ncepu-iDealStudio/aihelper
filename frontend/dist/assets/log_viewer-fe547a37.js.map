{"version":3,"file":"log_viewer-fe547a37.js","sources":["../../src/views/admin/log_viewer.vue"],"sourcesContent":["<template>\r\n  <div class=\"mb-4 flex flex-col\">\r\n    <n-tabs type=\"segment\" v-model:value=\"tab\">\r\n      <n-tab name=\"server\">{{ t(\"commons.serverLogs\") }}</n-tab>\r\n      <n-tab name=\"proxy\">{{ t(\"commons.proxyLogs\") }}</n-tab>\r\n    </n-tabs>\r\n    <!-- 设置 -->\r\n    <div class=\"flex flex-row mt-3 justify-between\">\r\n      <div class=\"flex flex-wrap flex-row sm:space-x-3\">\r\n        <div class=\"option-item\"><n-text>{{ t(\"commons.maxLineCount\") }}</n-text>\r\n          <n-input-number size=\"small\" v-model:value=\"maxLineCount\" class=\"w-27\" :min=\"100\" :max=\"2000\" :step=\"100\" />\r\n        </div>\r\n        <div class=\"option-item\"><n-text>{{ t(\"commons.updateInterval\") }}</n-text>\r\n          <n-select size=\"small\" v-model:value=\"refresh_duration\" class=\"w-20\" :options=\"[\r\n            { label: '3s', value: 3 },\r\n            { label: '5s', value: 5 },\r\n            { label: '10s', value: 10 },\r\n          ]\"></n-select>\r\n        </div>\r\n        <div class=\"option-item\"><n-text>{{ t(\"commons.excludeKeywords\") }}</n-text>\r\n          <n-dynamic-tags v-if=\"tab === 'proxy'\" size=\"small\" v-model:value=\"proxyExcludeKeywords\"></n-dynamic-tags>\r\n          <n-dynamic-tags v-else size=\"small\" v-model:value=\"serverExcludeKeywords\"></n-dynamic-tags>\r\n        </div>\r\n      </div>\r\n      <div class=\"flex items-center space-x-2\">\r\n        <n-text>{{ t(\"commons.autoScrolling\") }}</n-text>\r\n        <n-switch v-model:value=\"enableAutoScroll\" size=\"small\" />\r\n      </div>\r\n    </div>\r\n    <n-card class=\"mt-3 flex-grow h-full\" :content-style=\"{ height: '100%' }\">\r\n      <!-- <n-scrollbar ref=\"scrollRef\" class=\"h-160 relative\"> -->\r\n      <!-- <div class=\"whitespace-pre-line font-mono text-[0.2em]\">\r\n          {{ filteredLogsContent }}\r\n        </div> -->\r\n      <n-log ref=\"logInstRef\" :font-size=\"10\" :rows=\"40\" :lines=\"logsContent\" />\r\n      <!-- </n-scrollbar> -->\r\n    </n-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { getServerLogsApi, getProxyLogsApi } from '@/api/system';\r\nimport { LogFilterOptions } from '@/types/schema';\r\nimport { ref, computed, watch, nextTick } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\nconst { t } = useI18n();\r\n\r\nconst refresh_duration = ref(5);\r\nconst tab = ref<string>('server');\r\nconst logsContent = ref<Array<string>>();\r\nconst enableAutoScroll = ref(true);\r\nconst maxLineCount = ref(100);\r\nconst proxyExcludeKeywords = ref<Array<string>>([])\r\nconst serverExcludeKeywords = ref<Array<string>>([\r\n  \"status\",\r\n  \"logs\"\r\n])\r\n\r\nconst logInstRef = ref();\r\n\r\nwatch(() => tab.value, () => {\r\n  loadLogs();\r\n});\r\nwatch(() => maxLineCount.value, () => {\r\n  loadLogs();\r\n});\r\n\r\nconst scrollToBottom = () => {\r\n  nextTick(() => {\r\n    logInstRef.value?.scrollTo({ position: 'bottom', slient: false })\r\n  })\r\n}\r\n\r\nconst loadLogs = () => {\r\n  if (tab.value === 'server') {\r\n    getServerLogsApi({\r\n      max_lines: maxLineCount.value,\r\n      exclude_keywords: serverExcludeKeywords.value,\r\n    } as LogFilterOptions).then((res) => {\r\n      logsContent.value = res.data;\r\n    });\r\n  } else {\r\n    getProxyLogsApi({\r\n      max_lines: maxLineCount.value,\r\n      exclude_keywords: proxyExcludeKeywords.value,\r\n    } as LogFilterOptions).then((res) => {\r\n      logsContent.value = res.data;\r\n    });\r\n  }\r\n  if (enableAutoScroll.value) {\r\n    scrollToBottom();\r\n  }\r\n}\r\n\r\nloadLogs();\r\nlet interval = setInterval(() => {\r\n  loadLogs();\r\n}, refresh_duration.value * 1000);\r\n\r\nwatch(() => refresh_duration.value, () => {\r\n  clearInterval(interval);\r\n  interval = setInterval(() => {\r\n    loadLogs();\r\n  }, refresh_duration.value * 1000);\r\n});\r\n\r\nwatch(() => serverExcludeKeywords.value, () => {\r\n  loadLogs();\r\n});\r\n\r\nwatch(() => proxyExcludeKeywords.value, () => {\r\n  loadLogs();\r\n});\r\n\r\n</script>\r\n\r\n<style>\r\n.option-item {\r\n  @apply flex flex-row space-x-2 items-center mr-1 my-1;\r\n}\r\n</style>"],"names":["t","useI18n","refresh_duration","ref","tab","logsContent","enableAutoScroll","maxLineCount","proxyExcludeKeywords","serverExcludeKeywords","logInstRef","watch","loadLogs","scrollToBottom","nextTick","_a","getServerLogsApi","res","getProxyLogsApi","interval"],"mappings":"skBA6CA,KAAA,CAAA,EAAAA,GAAAC,IAEAC,EAAAC,EAAA,CAAA,EACAC,EAAAD,EAAA,QAAA,EACAE,EAAAF,IACAG,EAAAH,EAAA,EAAA,EACAI,EAAAJ,EAAA,GAAA,EACAK,EAAAL,EAAA,CAAA,CAAA,EACAM,EAAAN,EAAA,CAAiD,SAC/C,MACA,CAAA,EAGFO,EAAAP,IAEAQ,EAAA,IAAAP,EAAA,MAAA,IAAA,CACEQ,GAAS,CAAA,EAEXD,EAAA,IAAAJ,EAAA,MAAA,IAAA,CACEK,GAAS,CAAA,EAGX,MAAAC,EAAA,IAAA,CACEC,EAAA,IAAA,QACEC,EAAAL,EAAA,QAAA,MAAAK,EAAA,SAAA,CAAA,SAAA,SAAA,OAAA,EAAA,EAAgE,CAAA,CACjE,EAGHH,EAAA,IAAA,CACER,EAAA,QAAA,SACEY,EAAA,CAAiB,UAAAT,EAAA,MACS,iBAAAE,EAAA,KACgB,CAAA,EAAA,KAAAQ,GAAA,CAExCZ,EAAA,MAAAY,EAAA,IAAwB,CAAA,EAG1BC,EAAA,CAAgB,UAAAX,EAAA,MACU,iBAAAC,EAAA,KACe,CAAA,EAAA,KAAAS,GAAA,CAEvCZ,EAAA,MAAAY,EAAA,IAAwB,CAAA,EAG5BX,EAAA,OACEO,GACF,EAGFD,IACA,IAAAO,EAAA,YAAA,IAAA,CACEP,GAAS,EAAAV,EAAA,MAAA,GAAA,EAGX,OAAAS,EAAA,IAAAT,EAAA,MAAA,IAAA,CACE,cAAAiB,CAAA,EACAA,EAAA,YAAA,IAAA,CACEP,GAAS,EAAAV,EAAA,MAAA,GAAA,CACqB,CAAA,EAGlCS,EAAA,IAAAF,EAAA,MAAA,IAAA,CACEG,GAAS,CAAA,EAGXD,EAAA,IAAAH,EAAA,MAAA,IAAA,CACEI,GAAS,CAAA"}
{"version":3,"file":"index-eb7e7118.js","sources":["../../src/views/login/index.vue"],"sourcesContent":["<template>\r\n  <!-- Login Form -->\r\n  <div class=\"flex justify-center items-center mt-20\">\r\n    <n-form ref=\"formRef\" :model=\"formValue\" :rules=\"loginRules\" :label-col=\"{ span: 8 }\" :wrapper-col=\"{ span: 16 }\">\r\n      <n-form-item :label=\"$t('commons.username')\" path=\"username\">\r\n        <n-input v-model:value=\"formValue.username\" :placeholder=\"$t('tips.pleaseEnterUsername')\" :input-props=\"{\r\n          autoComplete: 'username'\r\n        }\" />\r\n      </n-form-item>\r\n      <n-form-item :label=\"$t('commons.password')\" path=\"password\">\r\n        <n-input type=\"password\" show-password-on=\"click\" v-model:value=\"formValue.password\" :placeholder=\"$t('tips.pleaseEnterPassword')\" :input-props=\"{\r\n          autoComplete: 'current-password'\r\n        }\" @keyup.enter=\"login\" />\r\n      </n-form-item>\r\n      <n-form-item wrapper-col=\"{ span: 16, offset: 8 }\">\r\n        <n-button type=\"primary\" @click=\"login\" :enabled=\"loading\">{{ $t(\"commons.login\") }}</n-button>\r\n      </n-form-item>\r\n    </n-form>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive } from 'vue';\r\nimport { useUserStore } from '@/store';\r\nimport { useRouter } from 'vue-router';\r\nimport { useI18n } from 'vue-i18n';\r\nimport { loginApi, LoginData } from '@/api/user';\r\nimport { Message } from '@/utils/tips';\r\nimport { FormValidationError } from 'naive-ui/es/form';\r\nimport { FormInst } from 'naive-ui'\r\n\r\nconst router = useRouter();\r\nconst { t } = useI18n();\r\nconst userStore = useUserStore();\r\nconst formRef = ref<FormInst>();\r\n\r\nconst formValue = reactive({\r\n  username: '',\r\n  password: ''\r\n});\r\nconst loading = ref(false);\r\nconst loginRules = {\r\n  username: { required: true, message: t(\"tips.pleaseEnterUsername\"), trigger: 'blur' },\r\n  password: { required: true, message: t(\"tips.pleaseEnterPassword\"), trigger: 'blur' }\r\n}\r\n\r\nconst login = async () => {\r\n  if (loading.value) return;\r\n  formRef.value?.validate((errors?: Array<FormValidationError>) => {\r\n    if (!errors) {\r\n      loading.value = true;\r\n    }\r\n  }).then(async () => {\r\n    try {\r\n        await userStore.login(formValue as LoginData);\r\n        const { redirect, ...othersQuery } = router.currentRoute.value.query;\r\n        await userStore.fetchUserInfo();\r\n        Message.success(t('tips.loginSuccess'));\r\n        await router.push({\r\n          name: userStore.user?.is_superuser ? 'admin' : 'conversation'\r\n        });\r\n        // TODO: 记住密码\r\n      } catch (error) {\r\n        console.log(error);\r\n      } finally {\r\n        loading.value = false;\r\n      }\r\n  });\r\n}\r\n\r\nif (userStore.user) {\r\n  router.push({ name: 'conversation' });\r\n}\r\n</script>"],"names":["router","useRouter","t","useI18n","userStore","useUserStore","formRef","ref","formValue","reactive","loading","loginRules","login","_a","errors","redirect","othersQuery","Message","error"],"mappings":"0TA+BA,MAAAA,EAAAC,IACA,CAAA,EAAAC,GAAAC,IACAC,EAAAC,IACAC,EAAAC,IAEAC,EAAAC,EAAA,CAA2B,SAAA,GACf,SAAA,EACA,CAAA,EAEZC,EAAAH,EAAA,EAAA,EACAI,EAAA,CAAmB,SAAA,CAAA,SAAA,GAAA,QAAAT,EAAA,0BAAA,EAAA,QAAA,MAAA,EACmE,SAAA,CAAA,SAAA,GAAA,QAAAA,EAAA,0BAAA,EAAA,QAAA,MAAA,CACA,EAGtFU,EAAA,SAAA,OACEF,EAAA,QACAG,EAAAP,EAAA,QAAA,MAAAO,EAAA,SAAAC,GAAA,CACEA,IACEJ,EAAA,MAAA,GACF,GAAA,KAAA,SAAA,OAEA,GAAA,CACI,MAAAN,EAAA,MAAAI,CAAA,EACA,KAAA,CAAA,SAAAO,EAAA,GAAAC,CAAA,EAAAhB,EAAA,aAAA,MAAA,MACA,MAAAI,EAAA,gBACAa,EAAA,QAAAf,EAAA,mBAAA,CAAA,EACA,MAAAF,EAAA,KAAA,CAAkB,MAAAa,EAAAT,EAAA,OAAA,MAAAS,EAAA,aAAA,QAAA,cAC+B,CAAA,CAChD,OAAAK,EAAA,CAGD,QAAA,IAAAA,CAAA,CAAiB,QAAA,CAEjBR,EAAA,MAAA,EAAgB,CAClB,EACH,EAGH,OAAAN,EAAA,MACEJ,EAAA,KAAA,CAAA,KAAA,cAAA,CAAA"}